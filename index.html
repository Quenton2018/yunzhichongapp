<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
	<meta name="misapplication-tap-highlight" content="no"/>
	<meta name="HandheldFriendly" content="true"/>
	<meta name="MobileOptimized" content="320"/>
    <title>主页</title>
	<link rel="stylesheet" href="css/mui.min.css" type="text/css" charset="utf-8">
	<link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8"/>
	<script src="js/jquery-3.3.1.min.js"></script>
	<script src="js/mui.min.js"></script>
	<script src="plugins/layer/layer.js"></script>
	<script src="js/fastclick.js"></script>
	<script src="js/base.js"></script>
	<script src="js/common.js"></script>
	<script src="js/mui.min.js"></script>
    <style type="text/css">
		.mui-content{background-image:url("img/app_11.png");background-size:cover;padding-bottom:110px;}
		.banner{display: block;width: 80%;margin: 0 auto;}
		.footer{width:100%;position:fixed;bottom:0;left:0;background:#fff;box-shadow:-2px -2px 2px 2px rgba(116,116,116,.1);border-radius:30px 30px 0 0;border-top:#FAFAFA solid 5px;}
		.footer-btn{width:80%;margin:0 auto;padding:20px 0;}
		.footer-btn .left{float:left;width:54%;}
		.footer-btn .right{float:left;width:43%;}
		.footer-btn img{display:block;width:100%;}
    </style>
</head>
<body>
	<header class="header header-immersed mui-bar mui-bar-nav">
		<a class="mui-icon iconfont icon-person mui-pull-left" href="views/menu.html"></a>
		<h1 class="mui-title">首页</h1>
		<a class="mui-icon iconfont icon-xiaoxi mui-icon-right-nav mui-pull-right" href="views/messageList.html"></a>	
	</header>
	
	<div class="mui-content" style="padding-top: 80px;">
		<img src="img/app_focus_04.png" class="banner" onclick="openWebview('views/recharge.html')">
	</div>

	<footer class="footer" style="text-align: center">
		<!--<div class="button" onclick="getCurrentPosition()">获取定位信息</div>-->
		<div class="footer-btn">
			<div class="left">			
				<img src="img/app_15.png" onclick="selectChargeMethod()" >
			</div>
			<div class="right">
				<a href="views/shoppingMall.html">
					<img src="img/app_16.png">
				</a>
			</div>
			<div style="clear: both"></div>
		</div>
	</footer>
		
<script type="text/javascript">
	var Permission = 'authorized';
	mui.plusReady(function(){
		plus.webview.currentWebview().setStyle({
			popGesture:'none' // 关闭侧滑返回功能
		});
		plus.key.addEventListener("backbutton",function(){
			plus.runtime.quit();
        });
	});
	plusUtils.pageReady(function(){
		getMidBigPic();	
        getUserInfo();       
		getCurrentPosition();			
//  	heatUpdate(); // 热更新
	});
	plusRefresh(dataRefresh);
	//刷新页面
	function dataRefresh(){
		getUserInfo();
     	getCurrentPosition();
	}
	//获取用户信息
    function getUserInfo(){
        if(vaildeParam(uuid)){
            postJSON(API_URL.ApiMemberInfo,{"uuid":uuid},function(res){
                if("0" == res.code){
              		setLoginData(res.data);
                }else{
                    layer.msg(res.msg);
                    clearLogin();
            		openWebview("views/login.html");
                }
            },true)
        }else{
        	layer.msg("用户不存在");
        	clearLogin();
            openWebview("views/login.html");
        }
    }
	//获取中间banner图片
    function getMidBigPic() {
        postJSON(API_URL.ApiCarouselImageGetCarouselImage,{},function(res){
            if("0" == res.code){
                var data = res.data;
                if(0 == data.length) return;
                var imgUrl = '';
                $.each(data, function(index,item) {
                    if(0 == index){
                        imgUrl = item.pic;
		                loadImage(imgUrl,function () {
		                    $(".banner").attr("src",imgUrl);
		                })
                    }
                });
            }else{
                toast(res.msg);
            }
        })
    }
    function countUnreadMessage(){
    	postJSON(API_URL.ApiMessageCountUnreadMessage,{'uuid':uuid},function(res){
    		if(res.code == '0'){
    			
    		}
    	})
    }
	function selectChargeMethod(){
		plusUtils.Storage.removeItem("chargingGroupId");
		openWebview("views/selectChargeMethod.html");
	}
	//页面点击事件
	mui('body').on('tap', 'a', function() {
		var href = this.getAttribute('href');
		if(!href) return;
		//非plus环境，直接走href跳转
		if(!mui.os.plus) {
			location.href = href;
			return;
		}
		openWebview(href);
	});
</script>

</body>
</html>