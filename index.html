<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>主页</title>
	<link rel="stylesheet" href="css/iconfont.css">
	<link rel="stylesheet" href="css/mui.min.css" type="text/css" charset="utf-8">
	<link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8"/>
	<script src="js/jquery-3.3.1.min.js"></script>
	<script src="plugins/layer/layer.js"></script>
	<script src="js/plusUtils.js"></script>
	<script src="js/common.js"></script>
	<script src="js/base.js"></script>
	<script src="js/mui.min.js"></script>
    <style type="text/css">
		.mui-content{background-image:url("img/app_11.png");background-size:cover;padding-bottom:110px;}
		.banner{display: block;width: 80%;margin: 0 auto;}
		.footer{width:100%;position:fixed;bottom:0;left:0;background:#fff;box-shadow:-2px -2px 2px 2px rgba(116,116,116,.1);border-radius:30px 30px 0 0;border-top:#FAFAFA solid 5px;}
		.footer-btn{width:80%;margin:0 auto;padding:20px 0;}
		.footer-btn .left{float:left;width:54%;}
		.footer-btn .right{float:left;width:43%;}
		.footer-btn img{display:block;width:100%;}
    </style>
</head>
<body>
	<header class="header header-immersed mui-bar mui-bar-nav">
		<a class="mui-icon iconfont icon-person mui-pull-left" onclick="openWebview('views/menu.html')"></a>
		<h1 class="mui-title">首页</h1>
		<a class="mui-icon iconfont icon-xiaoxi mui-icon-right-nav mui-pull-right" onclick="openWebview('views/messageList.html')"></a>	
	</header>
	
	<div class="mui-content" style="padding-top: 80px;">
		<img src="img/app_focus_04.png" class="banner" onclick="openWebview('views/recharge.html')">
	</div>

	<footer class="footer" style="text-align: center">
		<!--<div class="button" onclick="getCurrentPosition()">获取定位信息</div>-->
		<div class="footer-btn">
			<div class="left">
				<img src="img/app_15.png" id="views/selectChargeMethod.html" onclick="openWebview(this.id)" >
			</div>
			<div class="right">
				<img src="img/app_16.png" id="views/shoppingMall.html" onclick="openWebview(this.id)"  >
			</div>
			<div style="clear: both"></div>
		</div>
	</footer>
		
<script type="text/javascript">	
	$.plusReady(function() {
		checkPermissionPos();
		
		checkVersion(); 
		
    	// 热更新
    	heatUpdate(plus.os.name);

//		uploadLoginInfo('page/login.html');
		//获取用户信息
        getUserInfo(); 
        
        getMidBigPic();
        
		plus.push.addEventListener("onActivityResult", function(msg) {
            toast(msg);
        }, false );
	},function(){	
		getUserInfo(); 
		checkPermissionPos();
	});
    function getUserInfo(){
        if(vaildeParam(uuid)){
            postJSON(API_URL.ApiMemberInfo,{"uuid":uuid},function(res){
                if("0" == res.code){
                	setLoginData(res.data);
                }else{
                    toast(res.msg);
                    clearLogin();
                    openWebview("views/login.html");
                }
            },true)
        }
    }
	//获取中间banner图片
    function getMidBigPic() {
        postJSON(API_URL.ApiCarouselImageGetCarouselImage,{},function(res){
            if("0" == res.code){
                var data = res.data;
                if(0 == data.length) return;
                var imgUrl = '';
                $.each(data, function(index,item) {
                    if(0 == index){
                        imgUrl = item.pic;
		                loadImage(imgUrl,function () {
		                    $(".banner").attr("src",imgUrl);
		                })
                    }
                });
            }else{
                toast(res.msg);
            }
        })
    }

    //检查定位  
    function checkPermissionPos() {
        var pp = plus.navigator.checkPermission('LOCATION');
        console.log("## 获取定位权限 ##: "+pp)            
        switch(pp){
            case 'authorized':
				console.log('已开启定位权限');
				getCurrentPosition();
                break;
            case 'denied':
				console.log('已关闭定位权限');
                openSystemPositionServer();
                break;
            case 'undetermined':
                mui.alert('未确定定位权限', '定位消息');
                break;
            case 'unknown':
                mui.alert('无法查询定位权限', '定位消息');
                break;
            default:
				console.log('不支持定位权限');
                break;
        }
    }       
	// 打开手机设置 -> 隐私 -> 定位
	function openSystemPositionServer() {
		mui.alert("允许云智充获取位置权限，查找附近的充电桩，我们将按云智充隐私政策保护您的信息。不开启将影响使用云智充服务","开启定位服务","去开启",function(){
			//plus.runtime.openURL("App-Prefs:root=Privacy&path=LOCATION");
			if (/(iPhone|iPad|iPod|iOS)/i.test(navigator.userAgent)) {
				plus.runtime.openURL("app-settings:LOCATION");
			} else if (/android/i.test(navigator.userAgent)) {
				var main = plus.android.runtimeMainActivity();
				var Intent = plus.android.importClass("android.content.Intent");
				var Settings = plus.android.importClass('android.provider.Settings');
				var mIntent = new Intent('Settings.ACTION_LOCATION_SOURCE_SETTINGS');
				main.startActivity(mIntent);
			}
		})
	}
</script>

</body>
</html>