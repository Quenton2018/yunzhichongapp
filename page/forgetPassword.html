<!DOCTYPE HTML>
<html>
	<head>
		<meta charset="utf-8"/>
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
		<meta name="misapplication-tap-highlight" content="no"/>
		<meta name="HandheldFriendly" content="true"/>
		<meta name="MobileOptimized" content="320"/>
		<title>忘记密码</title>
		<link rel="stylesheet" href="../css/iconfont.css">
		<link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8"/>
		<link rel="stylesheet" href="../css/bootstrap.min.css" type="text/css" charset="utf-8"/>
		<link rel="stylesheet" href="../plugins/layer/theme/default/layer.css" type="text/css" charset="utf-8"/>
		<script src="../js/jquery-3.3.1.min.js"></script>
		<script src="../js/bootstrap.min.js"></script>
		<script src="../plugins/layer/layer.js"></script>
		<script src="../js/common.js"></script>
		<script src="../js/base.js"></script>
		
		<style type="text/css">
			.forgetPasswordBox{
				overflow: hidden;
				margin-top: 0;
				margin-bottom: 2rem;
				margin-left: 2rem;
				margin-right: 2rem;
			}
			.forgetPasswordBox .inputBox{
				position: relative;
				margin-bottom: 10px;
				font-size: 1.2rem;
			}
			.forgetPasswordBox .inputBox i{
				font-size: 1.2rem;
				position: absolute;
				left: 0px;
				line-height: 3rem;
				color: #9B999B;
			}
			.forgetPasswordBox input{
				-webkit-user-select:text;
				text-align:left;
				border: 0px;
				border-radius: 0;
				font-size:16px;
				width:100%;
				outline:none;
				line-height: 3rem;
				/*padding-left: 110px;*/
				border-bottom: #D8D8D8 solid 1px;
			}
			.forgetPasswordBox input:focus{
				outline: none;
			}
			.getCode{
				position: absolute;
				right: 10px;
				top: .7rem;
				color: #F88E36;
			}

			.Button-Img{
				width: 80%;
				display: block;
				margin: 0 auto;
			}

		</style>
	</head>
	<body style="background: #ffffff;">

	<header id="header2">
		<div class="headInner">
			<div class="left" id="back"  onclick="back()" ><img src="../img/app_back.png" /></div>
			<div class="right">&nbsp;</div>
			<div style="clear: both"></div>
		</div>
	</header>

	<div>
		<div class="myContent" style="padding-top: 70px;padding-bottom: 15px">
			<h1 class="pageBigTitle">找回密码</h1>
		</div>
	</div>

	<div class="my-Content">

		<div class="forgetPasswordBox">
			<div class="inputBox">
				<!--<i class="iconfont">手机号</i>-->
				<input type="number" name="mobile" placeholder="手机号" pattern="\d*" />
			</div>
			<div class="inputBox">
				<!--<i class="iconfont">短信验证码</i>-->
				<input type="text" name="code" placeholder="短信验证码" pattern="\d*" />
				<span class="getCode">获取验证码</span>
			</div>
			<div class="inputBox">
				<!--<i class="iconfont">密码</i>-->
				<input type="password" name="password" placeholder="密码" />
			</div>
		</div>

		<div>
			<img class="Button-Img loginBtn resetBtn"  src="../img/app_yes_btn.png" />
		</div>
	</div>

	<script type="application/javascript">

        var $getCodeBtn = $(".getCode");
        var isLock = false; //是否锁定
        var time = 60; //倒计时
        var timeInterval; //定时器
        /**
         * 定时器
         */
        function showTime(){
            timeInterval = setInterval(function(){
                time--;
                if(time <= 0){
                    isLock = false;
                    time = 60;
                    clearInterval(timeInterval);
                    $getCodeBtn.text('获取验证码');
                    return;
                }else{
                    $getCodeBtn.text(time);
                }
            },1000)
        }


        /**
         * 获取验证码
         */
        $(".getCode").click(function(){
            var mobile = $("input[name='mobile']").val();
            if(!vaildeParam(mobile)){
                layer.msg("手机号不能为空");
                return;
            }
            if(!isPoneAvailable(mobile)){
                layer.msg("手机格式不正确");
                return;
            }
            if(isLock){
                return;
            }
            isLock = true;
            $getCodeBtn.text(time);
            showTime();

            postJSON(API_URL.ApiSmsSendCode,{"mobile":mobile},function(res){
                if("0" == res.code){
                    layer.msg("发送成功");
                }else{
                    layer.msg(res.msg);
                }
            })
        })


        /**
		 *
         */
        $(".resetBtn").click(function(){
            var mobile = $("input[name='mobile']").val();
            if(!vaildeParam(mobile)){
                layer.msg("手机号不能为空");
                return;
            }
            if(!isPoneAvailable(mobile)){
                layer.msg("手机格式不正确");
                return;
            }
            var code = $("input[name='code']").val();
            if(!vaildeParam(code)){
                layer.msg("验证码不能为空");
                return;
            }
            var password = $("input[name='password']").val();
            if(!vaildeParam(password)){
                layer.msg("密码不能为空");
                return;
            }
            if(password.length<6){
                layer.msg("密码长度不少于6位");
                return;
            }
            var postData = {
                "mobile":mobile,
                "password":password,
                "code":code
            }
            postJSON(API_URL.APIfMemberForgetThePassword,postData,function(res){
                if("0" == res.code){
                    layer.msg("重置成功，正在跳转...");
                    setLoginData(res.data.uuid,res.data.mobile);
                    setTimeout(function(){
                        clicked('../index.html')
                    },2000);
                }else{
                    layer.msg(res.msg);
                }
            })
        })
        
        /**
		 * 校验手机号码
         * @param str
         * @returns {boolean}
         */
        function isPoneAvailable(str) {
            var myreg=/^[1][0-9]{10}$/;
            if (!myreg.test(str)) {
                return false;
            } else {
                return true;
            }
        }


	</script>
		
	</body>
</html>
