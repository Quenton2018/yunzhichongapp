<!doctype html>
<html>
<head>
	<meta charset="UTF-8">
	<title>个人中心</title>
	<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no,viewport-fit=cover"/>
	<meta name="misapplication-tap-highlight" content="no"/>
	<meta name="HandheldFriendly" content="true"/>
	<meta name="MobileOptimized" content="320"/>
	<link rel="shortcut icon" href="../favicon.ico">
	<link rel="stylesheet" href="../css/mui.min.css" type="text/css" charset="utf-8">
    <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8"/>
    <script src="../js/jquery-3.3.1.min.js"></script>
    <script src="../js/mui.min.js"></script>
    <script src="../plugins/layer/layer.js"></script>
    <script src="../js/fastclick.js"></script>
    <script src="../js/base.js"></script>
    <script src="../js/common.js"></script>   
    <style type="text/css">
		.yzc-main{width: 100%;height: 150px;margin-top: -5px;padding: 0 15px;position: relative;}
		.yzc-nav{margin: 0 15px;margin-top: 90px;border-radius: 6px;padding: 6px 0;}
		.user-info{position:relative;width: 100%;height: 135px;background-color: #fff;top: 80px;border-radius: 6px;}
		.user-avator{display:inline-block;width:100px;height:100px;position: absolute;left:50%;margin-left:-50px;top:-50px;z-index:99;}
		.user-avator img{width: 100px;height: 100px;border-radius: 50%;}
    	.user-name{text-align: center;color: #1A1A1A;font-size: 18px;}
    	.user-mobile{text-align: center;}
    	.user-signin{position: absolute;right:0;bottom:12px;width:70px;height:28px;line-height:28px;background:linear-gradient(90deg,rgba(252,94,83,1) 0%,rgba(250,131,91,1) 100%);border-radius:5px 0 0 5px;text-align: center;color: #fff;}		
    	.user-signin.isOn{background:#c3c3c3;}
		.mui-table-view:before,.mui-table-view:after{height: 0;}
    	.mui-table-view-cell{padding: 12px 15px;color: #4D4D4D;}
    	.mui-table-view-cell:after{left: 0;}
    	.mui-table-view-cell>a:not(.mui-btn).mui-active{background: none;}
    	.mui-table-view-cell.mui-active{background: none;}
		.mui-table-view-cell i{font-size: 20px;color: #4D4D4D;}
    	.yzc-nav li img {height: 20px;vertical-align: top;display: inline-block;margin-right: 10px;}
    	.mui-row-list{padding-top: 20px;}
    	.mui-row-list .balance{font-size: 22px;color: #4D4D4D;margin-bottom: 4px;}
		.mui-row-list .balance-text{margin:0}
    	.list-left{float: left;text-align: center;width: 35%;}
    	.list-right{float: right;text-align: center;width: 35%;}	
    </style>
</head>
<body style="background: #efeff4;">
	<header class="header header-immersed mui-bar mui-bar-nav">
		<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
	    <h1 class="mui-title">个人中心</h1>
		<a class="mui-icon mui-icon-gear mui-icon-right-nav mui-pull-right" href="setting.html"></a>
	</header>
	
	<div class="mui-content" style="background: #efeff4;">
		<div class="yzc-main linear">
			<div class="user-info">
				<a href="userInfo.html" class="user-avator">
					<img src="../img/user_profile/app_10.png" id="userAvator">
				</a>				
				<div class="mui-row">
					<div class="mui-row-list list-left">
						<p class="balance" id="money">0</p>
						<p class="balance-text">余额</p>
					</div>
					<div class="mui-row-list list-right">
						<p class="balance" id="points">0</p>
						<p class="balance-text">云钻</p>
					</div>
				</div>
				<p class="user-name" id="nickname">默认昵称</p>
				<p class="user-mobile" id="mobile">***********</p>
				<p class="user-signin" id="qianDao">签到</p>
			</div>
		</div>
		<ul class="yzc-nav mui-table-view">
			<li class="mui-table-view-cell">		
				<a href="chargeList.html" class="mui-navigate-right">
					<!-- <img src="../img/menu/app_1.png"> -->
					<i class="iconfont icon-cdz"></i>
					我的充电
				</a>
			</li>
			<li class="mui-table-view-cell">
				<a href="myWallet.html" class="mui-navigate-right">			
					<!-- <img src="../img/menu/app_2.png"> -->
					<i class="iconfont icon-wallet"></i>
					我的钱包
				</a>
			</li>
			<li class="mui-table-view-cell">
				<a href="myIcCard.html" class="mui-navigate-right">
					<!-- <img src="../img/menu/app_3.png" width="18px"> -->
					<i class="iconfont icon-ICcard"></i>
					我的IC卡
				</a>
			</li>
			<li class="mui-table-view-cell">
				<a href="applyCooperate.html" class="mui-navigate-right">
					<!-- <img src="../img/menu/app_4.png"> -->
					<i class="iconfont icon-shenqinghezuo"></i>
					申请合作
				</a>
			</li>
			<li class="mui-table-view-cell">
				<a href="invitation.html" class="mui-navigate-right">
					<!-- <img src="../img/menu/app_5.png"> -->
					<i class="iconfont icon-register"></i>			
					邀请好友
				</a>
			</li>
			<li class="mui-table-view-cell">
				<a href="customerService.html" class="mui-navigate-right">
					<!-- <img src="../img/menu/app_6.png" width="18px">-->
					<i class="iconfont icon-kefu"></i>
					客服中心
				</a>
			</li>
			<!-- <li class="mui-table-view-cell">
				<a href="bluetooth.html" class="mui-navigate-right">
					<img src="../img/menu/app_6.png" width="18px">
					<i class="iconfont icon-bluetooth"></i>
					蓝牙连接
				</a>
			</li> -->
		</ul>
	</div>
	<script type="text/javascript">
		mui.init();	
		plusUtils.pageReady(function() {
	        getUserInfo();
			isSignToday();
	    });	
		plusRefresh(dataRefresh);
		// 刷新页面
	    function dataRefresh(){
	        updateUserInfo();
			isSignToday();
	    }
		//更新用户信息
     	function updateUserInfo(){
            postJSON(API_URL.ApiMemberInfo,{"uuid":uuid},function(res){
                if("0" == res.code){
                    setLoginData(res.data);
                    getUserInfo();
                }else{
                    clearLogin();
            		openWebview("login.html",true,false);
                }
            })
	    }
		//取缓存里用户数据
	    function getUserInfo(){
	        var userinfo = plusUtils.Storage.getItem("userinfo");        
	        if(vaildeParam(userinfo)){
	        	userinfo = JSON.parse(userinfo);
	            var mobile = userinfo.mobile;
	            var headImage = userinfo.headImage;
	            var nickname = userinfo.nickname;
	            var money = userinfo.money;
	            var points = userinfo.points;
	            if(vaildeParam(headImage)){
	                $("#userAvator").attr("src",headImage);               
	            }
	            if(vaildeParam(nickname)){
	                $("#nickname").text(nickname);
	            }
	            if(vaildeParam(mobile)){
					var tel = mobile.replace(/(\d{3})\d*(\d{4})/,'$1****$2');
	                $("#mobile").text(tel);
	            }
	            if(vaildeParam(money)){
	                $("#money").text(money);
	            }
	            if(vaildeParam(points)){
	                $("#points").text(points);
	            }
	        }else{
	            clearLogin();
	            openWebview("login.html",true,false);
	        }
	    }
		function isSignToday(){		
			var params = {"uuid":uuid}
			postJSON(API_URL.ApiUserSignIsSignToday,params,function (res) {
				if(res.data){
					$(".user-signin").addClass("isOn").text("已签到");
				}else{
					$(".user-signin").removeClass("isOn").text("签到");
				}
			},true);
		}
	    //签到领云钻   
	    mui('body').on('tap', "#qianDao", function(e) {
			if($(this).hasClass('isOn')) return false;
	        var params = {"uuid":uuid}
	        postJSON(API_URL.ApiUserSignClickSign,params,function (res) {
	            if("0" == res.code){
	                var scoreTotal =  $("#points").text();
	                var score = res.data.score;
	                $("#points").text(parseInt(scoreTotal) + score);
					$(".user-signin").addClass("isOn").text("已签到");
	                layer.msg('今日签到成功赠送您'+score+"云钻");
					plusUtils.appPage.openerFire("setAllMessageRead");
	            }else{
	                layer.msg(res.msg);
	            }	
	        },true)
	    });
	    //页面点击事件
		mui('body').on('tap', 'a', function() {
			var href = this.getAttribute('href');
			if(!href) return;
			//非plus环境，直接走href跳转
			if(!mui.os.plus) {
				location.href = href;
				return;
			}
			openWebview(href);
		});
	</script>
</body>
</html>