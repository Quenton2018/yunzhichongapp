<!doctype html>
<html>
<head>
	<meta charset="UTF-8">
	<title>版本信息</title>
	<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
	<meta name="misapplication-tap-highlight" content="no"/>
	<meta name="HandheldFriendly" content="true"/>
	<meta name="MobileOptimized" content="320"/>
	<link rel="stylesheet" href="../css/mui.min.css" type="text/css" charset="utf-8">
    <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8"/>
    <script src="../js/jquery-3.3.1.min.js"></script>
    <script src="../js/mui.min.js"></script>
    <script src="../plugins/layer/layer.js"></script>
    <script src="../js/fastclick.js"></script>
    <script src="../js/base.js"></script>
    <script src="../js/common.js"></script> 
 
    <style type="text/css">
		.logo{margin: 50px 0;}
		.logo h2{color: #333;font-size: 18px;padding: 10px 0;}
		.bottom-content{margin-top:20px;text-align:center;}
		.bottom-content p{font-size:18px;color:#707070;line-height:20px;}
		.btn-submit{display:none;margin: 20px;border-radius: 50px;background:linear-gradient(86deg,rgba(255,156,44,1),rgba(255,109,34,1));}
    </style>
</head>
<body  style="background: #EBECEE;">
	<header class="header header-immersed mui-bar mui-bar-nav">
		<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
    	<h1 class="mui-title">版本信息</h1>
	</header>
	
	<div class="mui-content" style="background: #EBECEE;">
		<div class="logo">
			<img src="../img/logo_big.png" width="140" height="140"/>
			<h2>云智充</h2>
		</div>
		<div class="bottom-content" id="versionBox">
			<p>当前版本 : <span class="appVersion1">加载中...</span></p>
			<p>最新版本 : <span class="appVersion2">加载中...</span></p>
			<div class="btn-submit" id="downloadBtn">
				<span>点击下载</span>
			</div>
		</div>
	</div>
	<script type="text/javascript">
		$(".appVersion1").text(appVersion);
		plusUtils.pageReady(function() {
	        checkPageVersion();
	    });
	    function postJSON(url, data, callback,isIcon){
			if (plus.networkinfo.getCurrentType() == plus.networkinfo.CONNECTION_NONE) {
				layer.msg("网络异常，请检查网络设置！");
				return false;
			}
			url += "?"+jsonToParams(data);
			var xhr = new plus.net.XMLHttpRequest();	
			xhr.onreadystatechange = function () {
			    switch ( xhr.readyState ) {
			        case 4:       	
			            if ( xhr.status == 200 ) {
		            		var responseText = xhr.responseText;
		            		console.log("## postJSON ## url : "+url)
		            		console.log("## responseText: "+responseText)
		            	 	var json = JSON.parse(responseText);
		            	 	try{
								callback(json);
							}catch(e){						
								layer.msg("页面异常，请稍后再试！");
								console.error(e)
							}        		
			            } else {
		            		layer.msg("系统服务异常，请稍后再试！");
		            		console.log(url+"接口请求失败 :"+xhr.responseText)
			            }
			            break;
			        default :
			            break;
			    }
		    }
			xhr.open("POST", url);
			xhr.send(null);
		}
	    // 格式化 post 传递的数据
		function jsonToParams(obj) {
			if(typeof obj != "object") {
				alert("输入的参数必须是对象");
				return;
			}
			// 不支持FormData的浏览器的处理 
			var arr = new Array();
			var i = 0;
			for(var attr in obj) {
				arr[i] = encodeURIComponent(attr) + "=" + encodeURIComponent(obj[attr]);
				i++;
			}
			return arr.join("&");
		}
		/**
     	* 检查版本
     	*/
	    function checkPageVersion() {
	        var osName = plus.os.name;
	        var version = appVersion;
	        postJSON(API_URL.AppVersionGetNewest,{"appType":osName},function (res) {
				if (res.code == '0') {
					$(".appVersion2").text(res.data.version);
	                if (compareVersion(res.data.version)) {
						$("#downloadBtn").css("display",'block').click(function () {
	                       	plus.runtime.openURL(res.data.url);
	                    });
	                }
				}
	        })
	    }
	</script>
</body>
</html>