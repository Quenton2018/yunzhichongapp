<!doctype html>
<html>
<head>
	<meta charset="UTF-8">
	<title>个人中心</title>
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
	<link rel="stylesheet" href="../css/mui.min.css" type="text/css" charset="utf-8">
    <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8"/>
    <script src="../js/jquery-3.3.1.min.js"></script>
    <script src="../plugins/layer/layer.js"></script>
    <script src="../js/common.js"></script>
    <script src="../js/base.js"></script>    
    <style type="text/css">
		.yzc-main{width: 100%;height: 150px;background: linear-gradient(270deg,rgb(240,130,0) 0%,rgb(255,117,70) 100%);margin-top: -5px;
			padding: 0 15px;position: relative;}
		.user-info{position:relative;width: 100%;height: 135px;background-color: #fff;top: 80px;border-radius: 6px;}
		#userAvator {position: absolute;width: 100px;height: 100px;border-radius: 50%;left: 50%;margin-left: -50px;top: -50px;z-index: 99;}
    	.yzc-nav{margin: 0 15px;margin-top: 90px;border-radius: 6px;padding: 6px 0;}
    	.mui-table-view:before,.mui-table-view:after{height: 0;}
    	.mui-table-view-cell{padding: 12px 15px;color: #4D4D4D;}
    	.mui-table-view-cell:after{left: 0;}
    	.mui-table-view-cell>a:not(.mui-btn).mui-active{background: none;}
    	.mui-table-view-cell.mui-active{background: none;}
    	.yzc-nav li img {height: 20px;vertical-align: top;display: inline-block;margin-right: 10px;}
    	.mui-row-list{padding-top: 20px;}
    	.mui-row-list .balance{font-size: 22px;color: #4D4D4D;margin-bottom: 4px;}
    	.list-left .balance{padding-left: 40px;}
    	.list-left .balance-text{padding-left: 44px;margin: 0;}
    	.list-right .balance{padding-right: 40px;text-align: right;}
    	.list-right .balance-text{padding-right: 38px;text-align: right;margin: 0;}
    	.user-name{text-align: center;color: #1A1A1A;font-size: 18px;}
    	.user-mobile{text-align: center;}
    	.user-signin{position: absolute;right:0;bottom:12px;width:70px;height:28px;line-height:28px;background:linear-gradient(90deg,rgba(252,94,83,1) 0%,rgba(250,131,91,1) 100%);border-radius:5px 0 0 5px;text-align: center;color: #fff;}
    </style>
</head>
<body style="background: #efeff4;">
	<header class="header header-immersed mui-bar mui-bar-nav">
		<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
	    <h1 class="mui-title">个人中心</h1>
		<a class="mui-icon mui-icon-gear mui-icon-right-nav mui-pull-right" onclick="openWebview('setting.html')"></a>
	</header>
	
	<div class="mui-content" style="background: #efeff4;">
		<div class="yzc-main">
			<div class="user-info">
				<img src="../img/user_profile/app_10.png" id="userAvator" onclick="openWebview('userInfo.html')">
				<div class="mui-row">
					<div class="mui-row-list list-left mui-col-xs-6">
						<p class="balance" id="money">0</p>
						<p class="balance-text">余额</p>
					</div>
					<div class="mui-row-list list-right  mui-col-xs-6">
						<p class="balance" id="points">0</p>
						<p class="balance-text">云钻</p>
					</div>
				</div>
				<p class="user-name" id="nickname">默认昵称</p>
				<p class="user-mobile" id="mobile">***********</p>
				<p class="user-signin" id="qianDao">签到</p>
			</div>
		</div>
		<ul class="yzc-nav mui-table-view">
			<li class="mui-table-view-cell" onclick="openWebview('chargeList.html')">		
				<a class="mui-navigate-right"><img src="../img/menu/app_1.png">我的充电</a>
			</li>
			<li class="mui-table-view-cell" onclick="openWebview('myWallet.html')">
				<a class="mui-navigate-right"><img src="../img/menu/app_2.png">我的钱包</a>
			</li>
			<li class="mui-table-view-cell" onclick="openWebview('myIcCard.html')">
				<a class="mui-navigate-right"><img src="../img/menu/app_3.png" width="18px">我的IC卡</a>
			</li>
			<li class="mui-table-view-cell" onclick="openWebview('applyCooperate.html')">
				<a class="mui-navigate-right"><img src="../img/menu/app_4.png">申请合作</a>
			</li>
			<li class="mui-table-view-cell" onclick="openWebview('invitation.html')">
				<a class="mui-navigate-right"><img src="../img/menu/app_5.png">邀请好友</a>
			</li>
			<li class="mui-table-view-cell" onclick="openWebview('customerService.html')">
				<a class="mui-navigate-right"><img src="../img/menu/app_6.png" width="18px">客服中心</a>
			</li>
		</ul>
	</div>
	<script src="../js/mui.min.js"></script>
	<script type="text/javascript">
		mui.init();	
		$.plusReady(function(){
			getUserInfo();
		},dataRefresh);
		// 刷新页面
	    function dataRefresh(){
	        updateUserInfo();
	    }
		//更新用户信息
     	function updateUserInfo(){
        	if(vaildeParam(uuid)){
	            postJSON(API_URL.ApiMemberInfo,{"uuid":uuid},function(res){
	                if("0" == res.code){
	                    setLoginData(res.data);
	                    getUserInfo();
	                }else{
	                    layer.msg(res.msg);
	                    clearLogin();
	                    openWebview("login.html");
	                }
	            })
        	}
	    }
		//取缓存里用户数据
	    function getUserInfo(){
	        var userinfo = plus.storage.getItem("userinfo");        
	        if(vaildeParam(userinfo)){
	        	userinfo = JSON.parse(userinfo);
	            var mobile = userinfo.mobile;
	            var headImage = userinfo.headImage;
	            var nickname = userinfo.nickname;
	            var money = userinfo.money;
	            var points = userinfo.points;
	            if(vaildeParam(headImage)){
	                document.getElementById('userAvator').src = headImage;
	            }
	            if(vaildeParam(nickname)){
	                $("#nickname").text(nickname);
	            }
	            if(vaildeParam(mobile)){
					var tel = mobile.replace(/(\d{3})\d*(\d{4})/,'$1****$2');
	                $("#mobile").text(tel);
	            }
	            if(vaildeParam(money)){
	                $("#money").text(money);
	            }
	            if(vaildeParam(points)){
	                $("#points").text(points);
	            }
	        }else{
	            layer.msg("用户不存在");
	            clearLogin();
	            openWebview("login.html");
	        }
	    }
	    //签到领云钻
	    $("#qianDao").click(function () {
	        var params = {"uuid":uuid}
	        postJSON( API_URL.ApiUserSignClickSign,params,function (res) {
	            if("0" == res.code){
	               var scoreTotal =  $("#points").text()*1;
	                var score = res.data.score;
	                $("#points").text(scoreTotal+score);
	                layer.msg('今日签到成功赠送您'+score+"云钻");
	            }else{
	                layer.msg(res.msg);
	            }	
	        })
	    });
	</script>
</body>
</html>